(this.webpackJsonpcovidfront=this.webpackJsonpcovidfront||[]).push([[0],{15:function(e,t,a){e.exports=a(31)},20:function(e,t,a){},21:function(e,t,a){},31:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(12),o=a.n(r),s=(a(20),a(21),a(6)),l=a(3),c=a(4),d=a(5),u=a(7),m=a(2),h=a.n(m),p=a(8);a(23);var v={MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiYWVzdCIsImEiOiJjazk1ejE3MnEwZzh4M2dwMndkMHhvZTQwIn0.kNcRxl_xTpzuf_vwz9_MtQ",BACKEND_URL:"https://cvid19-back.herokuapp.com",MAPBOX_ACCESS_TOKEN_LIST:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";if(e)return e.split(t)}(Object({NODE_ENV:"production",PUBLIC_URL:"/covid19-br-vis-front",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiYWVzdCIsImEiOiJjazk1ejE3MnEwZzh4M2dwMndkMHhvZTQwIn0.kNcRxl_xTpzuf_vwz9_MtQ",REACT_APP_BACKEND_URL:"https://cvid19-back.herokuapp.com"}).MAPBOX_ACCESS_TOKEN_LIST)};function f(e,t,a,n){return g.apply(this,arguments)}function g(){return(g=Object(p.a)(h.a.mark((function e(t,a,n,i){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch(t,{mode:"cors"}).then((function(e){return e.json()})).then((function(e){return a(i(e))})).catch((function(e){console.error(e),n&&n(e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(p.a)(h.a.mark((function e(t,a){var n,i,r=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>2&&void 0!==r[2]?r[2]:function(e){return e},i="".concat(v.BACKEND_URL,"/api/v1/br/cities?response_type=json"),e.abrupt("return",f(i,t,a,n));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=a(10),E=a.n(b),C=a(13),S=a.n(C);function w(e,t){return Math.round(Math.abs((e-t)/864e5))}function k(e){var t=""+(e.getMonth()+1),a=""+e.getDate(),n=e.getFullYear();return t.length<2&&(t="0"+t),a.length<2&&(a="0"+a),[a,t,n].join("/")}var O={lastUpdate:{color:"#949494",fontSize:".6em"},cityName:{fontSize:"1em"},dataValue:{color:"#3b3b3b",fontSize:".9em"}},_=function(e){var t=e.name,a=e.state,n=e.date,r=e.cases,o=e.deaths;return i.a.createElement("div",{className:"cityListItem"},i.a.createElement("span",{style:O.lastUpdate},"\xdaltima atualiza\xe7\xe3o ",k(n)),i.a.createElement("br",null),i.a.createElement("span",{style:O.cityName},i.a.createElement("b",null,t,"/",a)),i.a.createElement("br",null),i.a.createElement("span",{style:O.dataValue},i.a.createElement("b",null,"Casos:")," ",r),i.a.createElement("br",null),i.a.createElement("span",{style:O.dataValue},i.a.createElement("b",null,"\xd3bitos:")," ",o))};E.a.accessToken=v.MAPBOX_ACCESS_TOKEN;var z=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).renderCityListItem=function(e,t){var a=n.state.renderableCities[e];return i.a.createElement(_,{name:a.city,state:a.state,date:new Date(a.date),cases:a.totalCases,deaths:a.deaths,key:t})};var r=new Date("2020-02-25");return n.baseUrl=v.BACKEND_URL,n.onSourceLoadBegin=n.props.onSourceLoadBegin,n.onSourceLoadFinished=n.props.onSourceLoadFinished,n.state={lng:e.lng||5,lat:e.lat||34,zoom:e.zoom||2,date:new Date,sliderValue:w(new Date("2020-02-25"),new Date),data:n.props.data,visibleCities:[],renderableCities:[],animate:!1,initialDate:r,maxDays:w(r,new Date),mapType:"infected"},n}return Object(c.a)(a,[{key:"getVisibleOnMap",value:function(){var e=this.state.map.queryRenderedFeatures({layers:["all-cities"]}),t={};if(e){e=e.sort((function(e,t){return new Date(e.date)-new Date(t.date)})).map((function(e){return e.properties}));var a,n=Object(s.a)(e);try{for(n.s();!(a=n.n()).done;){var i=a.value,r=i.city;!t.hasOwnProperty(r)&&i.timestamp<=this.state.date.getTime()&&(t[r]=i)}}catch(o){n.e(o)}finally{n.f()}return Object.keys(t).map((function(e){return t[e]}))}return[]}},{key:"updateVisibleCities",value:function(){if(this.state.zoom>5){var e=this.getVisibleOnMap();void 0!==e&&this.setState({visibleCities:e,renderableCities:e.sort((function(e,t){return e.totalCases-t.totalCases})).reverse()})}else this.setState({visibleCities:[],renderableCities:[]})}},{key:"animatedStep",value:function(){var e=this;this.state.animate?(this.changeSlider(0),this.animateTimeout=setInterval((function(){e.state.sliderValue<=e.state.maxDays?e.changeSlider(e.state.sliderValue+1):setTimeout((function(){e.changeSlider(0)}),2e3)}),400)):this.animateTimeout&&clearInterval(this.animateTimeout)}},{key:"changeSlider",value:function(e){var t=parseInt(e),a=function(e,t){var a=new Date(e.valueOf());return a.setDate(a.getDate()+t),a}(this.state.initialDate,t);this.setState({sliderValue:t,date:a}),this.updateVisibleCities(),this.state.map.setFilter("covid-heatmap",["<=",["number",["get","timestamp"]],a.getTime()]),this.state.map.setFilter("covid-heatmap-death",["<=",["number",["get","timestamp"]],a.getTime()]),this.state.map.setFilter("covid-point",["==",["number",["get","timestamp"]],a.getTime()])}},{key:"handleMapTypeChange",value:function(e){this.setState({mapType:e.target.value});var t="covid-heatmap-death",a="covid-heatmap";"infected"===e.target.value?(this.state.map.setLayoutProperty(a,"visibility","visible"),this.state.map.setLayoutProperty(t,"visibility","none")):(this.state.map.setLayoutProperty(a,"visibility","none"),this.state.map.setLayoutProperty(t,"visibility","visible"))}},{key:"handleAnimateChange",value:function(e){var t=this;this.setState({animate:e.target.checked},(function(){t.animatedStep()}))}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{style:this.props.containerStyle},i.a.createElement("div",{className:"console"},i.a.createElement("h1",null,"COVID-19 no Brasil at\xe9 o dia ",k(this.state.date)," ",function(){var t=w(e.state.date,new Date);return 0===t?"(hoje)":1===t?"(ontem)":"(h\xe1 ".concat(t," dias)")}()),i.a.createElement("p",null,"Fonte de dados: ",i.a.createElement("a",{href:"https://covid19br.wcota.me/"},"N\xfamero de casos confirmados de COVID-19 no Brasil")),i.a.createElement("div",{className:"session sliderbar"},i.a.createElement("h2",null,"Data ",k(this.state.date),": ",i.a.createElement("label",{className:"active-hour"},this.state.hour)),i.a.createElement("form",null,i.a.createElement("label",null,i.a.createElement("input",{name:"animate",type:"checkbox",checked:this.state.animate,onChange:function(t){return e.handleAnimateChange(t)}}),"Animar")),i.a.createElement("input",{className:"slider row",type:"range",min:"0",max:this.state.maxDays,step:"1",value:this.state.sliderValue,onChange:function(t){return e.changeSlider(t.target.value)}})),i.a.createElement("form",null,i.a.createElement("label",null,i.a.createElement("input",{type:"radio",value:"infected",checked:"infected"===this.state.mapType,onChange:function(t){return e.handleMapTypeChange(t)}}),"Casos"),i.a.createElement("span",null," | "),i.a.createElement("label",null,i.a.createElement("input",{type:"radio",value:"death",checked:"death"===this.state.mapType,onChange:function(t){return e.handleMapTypeChange(t)}}),"\xd3bitos")),i.a.createElement("div",null),i.a.createElement("div",null,i.a.createElement("div",{className:"cityList"},this.state.renderableCities.length>0?i.a.createElement(S.a,{itemRenderer:this.renderCityListItem,length:this.state.renderableCities.length,type:"uniform",pageSize:3}):i.a.createElement("p",null,"Zoom para mais detalhes.")))),i.a.createElement("div",{style:this.props.style,ref:function(t){return e.mapContainer=t}}))}},{key:"componentDidMount",value:function(){var e=this;this.onSourceLoadBegin&&this.onSourceLoadBegin();var t=new E.a.Map({container:this.mapContainer,style:"mapbox://styles/aest/ck93dlpxn00v21imgp8zz3y6x?optimize=true",center:[this.state.lng,this.state.lat],zoom:this.state.zoom,minPitch:0,maxPitch:0,pitchWithRotate:!1,logoPosition:"bottom-right"});this.setState({map:t}),t.on("move",(function(){e.setState({lng:t.getCenter().lng.toFixed(4),lat:t.getCenter().lat.toFixed(4),zoom:t.getZoom().toFixed(2)})})),t.on("load",(function(){t.addSource("covid",{type:"geojson",data:"".concat(e.baseUrl,"/api/v1/br/cities?response_type=geojson")}),t.addSource("covid-cities-daily",{type:"geojson",data:"".concat(e.baseUrl,"/api/v1/br/cities-daily?response_type=geojson")}),t.on("moveend",(function(){e.updateVisibleCities()})),t.addLayer({id:"covid-heatmap-death",type:"heatmap",source:"covid",visibility:"none",paint:{"heatmap-weight":["interpolate",["linear"],["number",["get","newDeaths"]],0,0,20,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(255,237,68,0)",.1,"#ff9671",.15,"#ffc75f",.2,"#e24f4f",.4,"#c02f36",.6,"#9e001f",.8,"#7d0006",1,"#5e0000"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,15,0]}},"waterway-label"),t.addLayer({id:"covid-heatmap",type:"heatmap",source:"covid",paint:{"heatmap-weight":["interpolate",["linear"],["number",["get","newCases"]],0,0,20,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(255,237,68,0)",.05,"rgb(72,244,66)",.15,"rgb(68,102,237)",.4,"rgb(249,169,0)",.6,"rgb(255,52,45)",.8,"rgb(233,3,8)",1,"rgb(199,5,9)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,15,0]}},"waterway-label"),t.addLayer({id:"covid-point",type:"circle",source:"covid-cities-daily",minzoom:8,paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,["interpolate",["linear"],["number",["get","totalCases"]],1,1,6,4],16,["interpolate",["linear"],["number",["get","totalCases"]],1,5,6,50]],"circle-color":["interpolate",["linear"],["number",["get","totalCases"]],1,"rgba(33,102,172,0)",2,"rgb(178,24,43)"],"circle-stroke-color":"white","circle-stroke-width":1,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}},"waterway-label"),t.addLayer({id:"all-cities",type:"circle",source:"covid",minzoom:5,paint:{"circle-color":"rgba(0,0,0,0)","circle-stroke-width":0}})})),t.on("idle",(function(){e.onSourceLoadFinished&&!e.state.animate&&e.onSourceLoadFinished()}))}}]),a}(n.Component),L=a(14),T=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).complete=function(){n.setState({loadingBarProgress:100}),n.clearIntervals()},n.onLoaderFinished=function(){n.setState({loadingBarProgress:0})},n.infiniteLoad=function(){n.setState({loadingBarProgress:n.state.loadingBarProgress+Math.round(5+5*Math.random())}),n.timers.push(setInterval((function(){n.setState({loadingBarProgress:n.state.loadingBarProgress+Math.round(5*Math.random())})}),800))},n.state={covidCasesGeoJson:void 0,covidCasesJson:void 0,loadingBarProgress:0},n.timers=[],n}return Object(c.a)(a,[{key:"clearIntervals",value:function(){var e,t=Object(s.a)(this.timers);try{for(t.s();!(e=t.n()).done;){var a=e.value;clearInterval(a)}}catch(n){t.e(n)}finally{t.f()}}},{key:"add",value:function(e){this.setState({loadingBarProgress:this.state.loadingBarProgress+e})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement(L.a,{progress:this.state.loadingBarProgress,height:3,color:"red",onLoaderFinished:function(){return e.onLoaderFinished()}}),i.a.createElement(z,{style:{right:0,left:0,height:"95vh",width:"100%"},data:this.state.covidCasesGeoJson,zoom:3,lat:-13.5958,lng:-54.4587,onSourceLoadBegin:this.infiniteLoad,onSourceLoadFinished:function(){e.complete()}}))}},{key:"componentDidMount",value:function(){var e=this;!function(e,t){y.apply(this,arguments)}((function(t){e.setState({covidCasesJson:t})}),console.error)}},{key:"componentWillUnmount",value:function(){this.clearIntervals()}}]),a}(n.Component);var D=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(T,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(D,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[15,1,2]]]);
//# sourceMappingURL=main.b47f6d7e.chunk.js.map